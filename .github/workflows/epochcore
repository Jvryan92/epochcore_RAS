name: EpochCore Capsules

on:
  schedule: [{cron: "0 4 * * *"}]  # nightly UTC
  pull_request:
    types: [opened, reopened, closed]

jobs:
  forge:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: sudo apt-get update && sudo apt-get install -y uuid-runtime zip jq
      - run: chmod +x ultra_trigger_pack_batch.sh verify.sh
      - name: ROI burst nightly
        if: github.event_name == 'schedule'
        run: ./ultra_trigger_pack_batch.sh --batch roi-burst --window "03:30-05:30"
      - name: Governance on PR
        if: github.event_name == 'pull_request'
        run: ./ultra_trigger_pack_batch.sh --batch gov-harden --max-caps 3
      - name: Verify
        run: ./verify.sh
      - uses: actions/upload-artifact@v4
        with: {name: capsules, path: out/**}